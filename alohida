<script setup>
import { ref, reactive, watch, onMounted } from "vue";
import { useProductsStore } from "@/stores/productsStore";
import { useProductsCategories } from "@/stores/productsCategories";
import { useCategoryStore } from "@/stores/categorySingleStore";
import { useFavouriteStore } from "@/stores/favouriteStore";
import { useBasketStore } from "@/stores/basketStore";
import debounce from "lodash.debounce";
import LocationIcon from "@/assets/icons/LocationIcon.vue";
import UserIcon from "@/assets/icons/UserIcon.vue";
import HeartIcon from "@/assets/icons/HeartIcon.vue";
import BasketIcon from "@/assets/icons/BasketIcon.vue";
import RusIcon from "@/assets/icons/RusIcon.vue";
import UzbIcon from "@/assets/icons/UzbIcon.vue";
import { i18n } from "@/main";

const favouriteStore = useFavouriteStore();
const basketStore = useBasketStore();
const productsCategories = useProductsCategories();
productsCategories.getCategories();

const productsStore = useProductsStore();
const categoryStore = useCategoryStore();

const show = ref(false);
const language = ref(localStorage.lang == 'UZ' ? true : false);
// const languageUz = ref(localStorage.lang == 'UZ' ? false : true);

const toggleShow = () => {
    show.value = !show.value;
};

const test = (lang) => {
    localStorage.lang = lang;
    console.log(localStorage.lang);
    if (lang == "UZ") {
        i18n.global.locale = localStorage.lang;
        language.value = true;
    } else if (lang == "RU") {
        i18n.global.locale = localStorage.lang;
        language.value = false;
    }

    // languageRu.value = lang;
    // languageUz.value = !lang;
};

// const toggleLanguageUz = () => {
//   languageRu.value = true;
//   languageUz.value = false;
//   console.log("Ru");
//   this.$i18n.locale = 'RU'
// };

// const toggleLanguageRu = () => {
//   languageRu.value = false;
//   languageUz.value = true;
//   console.log("Uz");
//   this.$i18n.locale = 'UZ'
// };

const searchInput = ref("");

watch(
    searchInput,
    debounce(() => {
        productsStore.getProducts(1 * 20 - 20, searchInput.value.trim());
    }, 500)
);
</script>

<template>
    <nav class="nav">
        <div class="nav__top">
            <div class="container">
                <p class="nav__top-1">
                    <LocationIcon /> {{ $t("nav__top-1") }}
                    <a href="https://maps.app.goo.gl/2tNs8A9QYtZ47YLK9">Toshkent</a>
                </p>
                <p class="nav__top-2">{{ $t("nav__top-2") }}</p>
                <div class="nav__top-div">
                    <!-- <RouterLink to="/orders" class="nav__top-3">Buyurtmalarim</RouterLink> -->
                    <RouterLink to="/orders" class="nav__top-3">{{ $t("nav__top-3") }}</RouterLink>
                    <button class="nav__top-laungage-uz" v-show="!language" @click="test('UZ')"><UzbIcon />UZ</button>
                    <button class="nav__top-laungage-ru" v-show="language" @click="test('RU')"><RusIcon />RU</button>

                    <!-- <button
            class="nav__top-laungage-uz"
            @click="$i18n.locale = 'UZ'"
          >
            <UzbIcon />UZ
          </button>
          <button
            class="nav__top-laungage-ru"
            @click="$i18n.locale = 'RU'"
          >
            <RusIcon />RU
          </button> -->
                </div>
            </div>
        </div>
        <div class="container">
            <div class="nav__titles">
                <button @click="toggleShow" class="burger">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <RouterLink class="nav__titles-title" to="/">Smart Shop</RouterLink>
            </div>
            <div class="nav__inputs">
                <input v-model="searchInput" type="search" name="text" class="search-bar" :placeholder="$t('search-bar')" />
                <!-- <button v-if="searchInput.trim() !== ''" @click="clearSearchInput">X</button> -->
            </div>

            <div class="nav__pages">
                <RouterLink class="nav__pages-user" to="/login"> <UserIcon /> {{ $t("nav__pages-user") }} </RouterLink>
                <RouterLink class="nav__pages-favourites" to="/favourite">
                    <HeartIcon /> {{ $t("nav__pages-favourites") }}
                    <span v-if="favouriteStore.favourites.length > 0" class="fav-count">
                        {{ favouriteStore.favourites.length }}
                    </span>
                </RouterLink>

                <RouterLink to="/drawer" class="nav__pages-basket" @click="openDrawer = true">
                    <BasketIcon /> {{ $t("nav__pages-basket") }}
                    <span class="basket-count" v-if="basketStore.drawer.length > 0">
                        {{ basketStore.drawer.length }}
                    </span>
                </RouterLink>
            </div>
        </div>
        <Transition name="fade">
            <div class="nav__category" v-show="show">
                <div class="nav__category-titles">
                    <h3 class="nav__category-title">Katalog</h3>
                    <button class="nav__category-x" @click="show = false">X</button>
                </div>
                <div class="nav__category-pages">
                    <RouterLink
                        v-for="title in productsCategories.categorie"
                        :to="'/category/' + title"
                        class="nav__category-page"
                        :key="title.id"
                        @click="(show = false), categoryStore.getCategorySingle(title)"
                    >
                        {{ title }}
                    </RouterLink>
                </div>
            </div>
        </Transition>
        <Transition name="fade2">
            <button v-show="show" class="nav__category-bg" @click="show = false"></button>
        </Transition>
    </nav>
</template>
